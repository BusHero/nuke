"use strict";(self.webpackChunknuke_website=self.webpackChunknuke_website||[]).push([[3439],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||a;return n?o.createElement(f,i(i({ref:t},u),{},{components:n})):o.createElement(f,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},90721:function(e,t,n){n.d(t,{Z:function(){return g}});var o=n(87462),r=n(63366),a=n(67294);function i(e){var t=e.toc,n=e.className,o=e.linkClassName,r=e.isChild;return t.length?a.createElement("ul",{className:r?void 0:n},t.map((function(e){return a.createElement("li",{key:e.id},a.createElement("a",{href:"#"+e.id,className:null!=o?o:void 0,dangerouslySetInnerHTML:{__html:e.value}}),a.createElement(i,{isChild:!0,toc:e.children,className:n,linkClassName:o}))}))):null}var l=a.memo(i),s=["parentIndex"];function c(e){var t=e.map((function(e){return Object.assign({},e,{parentIndex:-1,children:[]})})),n=Array(7).fill(-1);t.forEach((function(e,t){var o=n.slice(2,e.level);e.parentIndex=Math.max.apply(Math,o),n[e.level]=t}));var o=[];return t.forEach((function(e){var n=e.parentIndex,a=(0,r.Z)(e,s);n>=0?t[n].children.push(a):o.push(a)})),o}function u(e){var t=e.toc,n=e.minHeadingLevel,o=e.maxHeadingLevel;return t.flatMap((function(e){var t=u({toc:e.children,minHeadingLevel:n,maxHeadingLevel:o});return function(e){return e.level>=n&&e.level<=o}(e)?[Object.assign({},e,{children:t})]:t}))}var d=n(86668);function p(e){var t=e.getBoundingClientRect();return t.top===t.bottom?p(e.parentNode):t}function m(e,t){var n,o,r=t.anchorTopOffset,a=e.find((function(e){return p(e).top>=r}));return a?function(e){return e.top>0&&e.bottom<window.innerHeight/2}(p(a))?a:null!=(o=e[e.indexOf(a)-1])?o:null:null!=(n=e[e.length-1])?n:null}function f(){var e=(0,a.useRef)(0),t=(0,d.L)().navbar.hideOnScroll;return(0,a.useEffect)((function(){e.current=t?0:document.querySelector(".navbar").clientHeight}),[t]),e}function h(e){var t=(0,a.useRef)(void 0),n=f();(0,a.useEffect)((function(){if(!e)return function(){};var o=e.linkClassName,r=e.linkActiveClassName,a=e.minHeadingLevel,i=e.maxHeadingLevel;function l(){var e=function(e){return Array.from(document.getElementsByClassName(e))}(o),l=function(e){for(var t=e.minHeadingLevel,n=e.maxHeadingLevel,o=[],r=t;r<=n;r+=1)o.push("h"+r+".anchor");return Array.from(document.querySelectorAll(o.join()))}({minHeadingLevel:a,maxHeadingLevel:i}),s=m(l,{anchorTopOffset:n.current}),c=e.find((function(e){return s&&s.id===function(e){return decodeURIComponent(e.href.substring(e.href.indexOf("#")+1))}(e)}));e.forEach((function(e){!function(e,n){if(n){var o;t.current&&t.current!==e&&(null==(o=t.current)||o.classList.remove(r)),e.classList.add(r),t.current=e}else e.classList.remove(r)}(e,e===c)}))}return document.addEventListener("scroll",l),document.addEventListener("resize",l),l(),function(){document.removeEventListener("scroll",l),document.removeEventListener("resize",l)}}),[e,n])}var v=["toc","className","linkClassName","linkActiveClassName","minHeadingLevel","maxHeadingLevel"];function g(e){var t=e.toc,n=e.className,i=void 0===n?"table-of-contents table-of-contents__left-border":n,s=e.linkClassName,p=void 0===s?"table-of-contents__link":s,m=e.linkActiveClassName,f=void 0===m?void 0:m,g=e.minHeadingLevel,k=e.maxHeadingLevel,y=(0,r.Z)(e,v),N=(0,d.L)(),b=null!=g?g:N.tableOfContents.minHeadingLevel,j=null!=k?k:N.tableOfContents.maxHeadingLevel,w=function(e){var t=e.toc,n=e.minHeadingLevel,o=e.maxHeadingLevel;return(0,a.useMemo)((function(){return u({toc:c(t),minHeadingLevel:n,maxHeadingLevel:o})}),[t,n,o])}({toc:t,minHeadingLevel:b,maxHeadingLevel:j});return h((0,a.useMemo)((function(){if(p&&f)return{linkClassName:p,linkActiveClassName:f,minHeadingLevel:b,maxHeadingLevel:j}}),[p,f,b,j])),a.createElement(l,(0,o.Z)({toc:w,className:i,linkClassName:p},y))}},56645:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var o=n(87462),r=n(63366),a=(n(67294),n(3905));n(90721);var i=["components"],l={title:"Solution & Project Model"},s=void 0,c={unversionedId:"common/solution-project-model",id:"common/solution-project-model",title:"Solution & Project Model",description:"Particularly when building .NET applications, your build may require information related to solution or project files. Such information is often duplicated with string literals and quickly becomes out-of-date. For instance, when publishing a project you want to build for every target framework that is defined in the project file. NUKE has best-in-class support to read and modify the .NET solution and project model.",source:"@site/docs/03-common/07-solution-project-model.md",sourceDirName:"03-common",slug:"/common/solution-project-model",permalink:"/docs/common/solution-project-model",draft:!1,editUrl:"https://github.com/nuke-build/nuke/edit/develop/website/docs/03-common/07-solution-project-model.md",tags:[],version:"current",lastUpdatedBy:"Matthias Koch",lastUpdatedAt:1655975335,formattedLastUpdatedAt:"6/23/2022",sidebarPosition:7,frontMatter:{title:"Solution & Project Model"},sidebar:"tutorialSidebar",previous:{title:"Versioning Artifacts",permalink:"/docs/common/versioning"},next:{title:"Invoking CLI Tools",permalink:"/docs/common/cli-tools"}},u={},d=[{value:"Working with Solutions",id:"working-with-solutions",level:2},{value:"Read &amp; Write",id:"read--write",level:3},{value:"Strong-Typed Project Access",id:"strong-typed-project-access",level:3},{value:"Creating Solutions",id:"creating-solutions",level:3},{value:"Working with Projects through MSBuild",id:"working-with-projects-through-msbuild",level:2}],p={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Particularly when building .NET applications, your build may require information related to solution or project files. Such information is often duplicated with string literals and quickly becomes out-of-date. For instance, when publishing a project you want to build for every target framework that is defined in the project file. NUKE has best-in-class support to read and modify the .NET solution and project model."),(0,a.kt)("h2",{id:"working-with-solutions"},"Working with Solutions"),(0,a.kt)("p",null,"The easiest way to load your solution is to create a new ",(0,a.kt)("inlineCode",{parentName:"p"},"Solution")," field, add the ",(0,a.kt)("inlineCode",{parentName:"p"},"SolutionAttribute"),", and define the file path into the default ",(0,a.kt)("a",{parentName:"p",href:"/docs/fundamentals/parameters#passing-values-through-parameter-files"},"parameters file"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'[Solution]\nreadonly Solution Solution;\n\nTarget Print => _ => _\n    .Executes(() =>\n    {\n        Log.Information("Solution path = {Value}", Solution);\n        Log.Information("Solution directory = {Value}", Solution.Directory);\n    });\n')),(0,a.kt)("p",null,"You can also manually load solutions with the ",(0,a.kt)("inlineCode",{parentName:"p"},"ProjectModelTasks"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var solution = ProjectModelTasks.ParseSolution("/path/to/file");\n')),(0,a.kt)("h3",{id:"read--write"},"Read & Write"),(0,a.kt)("p",null,"With an instance of the ",(0,a.kt)("inlineCode",{parentName:"p"},"Solution")," type you can ",(0,a.kt)("strong",{parentName:"p"},"read and write the solution")," in regards to projects, solution folders, items, and build configurations:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'// Gather projects\nvar globalToolProject = Solution.GetProject("Nuke.GlobalTool");\nvar testProjects = Solution.GetProjects("*.Tests");\n\n// Gather all solution items\nvar allItems = Solution.AllSolutionFolders.SelectMany(x => x.Items);\n\n// Add a new project to solution\nvar project = Solution.AddProject(\n    name: "DummyProject",\n    typeId: ProjectType.CSharpProject,\n    path: RootDirectory / "DummyProject.csproj");\nSolution.Save();\n')),(0,a.kt)("h3",{id:"strong-typed-project-access"},"Strong-Typed Project Access"),(0,a.kt)("p",null,"Using the ",(0,a.kt)("inlineCode",{parentName:"p"},"GenerateProjects")," property you can enable a ",(0,a.kt)("a",{parentName:"p",href:"https://devblogs.microsoft.com/dotnet/introducing-c-source-generators/"},"source generator")," that provides ",(0,a.kt)("strong",{parentName:"p"},"strong-typed access to the solution structure"),". This greatly improves how you can reference individual projects:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"[Solution(GenerateProjects = true)]\nreadonly Solution Solution;\n\nProject GlobalToolProject => Solution.Nuke_GlobalTool;\n")),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"For every ",(0,a.kt)("inlineCode",{parentName:"p"},"SolutionAttribute")," with the ",(0,a.kt)("inlineCode",{parentName:"p"},"GenerateProjects")," property enabled, the source generator will create a new type with the same name as the field. In the example above, the type ",(0,a.kt)("inlineCode",{parentName:"p"},"Nuke.Common.ProjectModel.Solution")," is silently replaced by a new type ",(0,a.kt)("inlineCode",{parentName:"p"},"global::Solution")," that is local to your project. Therefore, the field name and type must always be the same."))),(0,a.kt)("h3",{id:"creating-solutions"},"Creating Solutions"),(0,a.kt)("p",null,"Apart from reading and writing from existing solutions, you can also ",(0,a.kt)("strong",{parentName:"p"},"create new solution files"),". This can be very helpful to generate a global solution for many decoupled solutions in different repositories:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var globalSolution = CreateSolution(\n    fileName: "global.generated.sln",\n    solutions: new[] { MainSolution }.Concat(ExternalSolutions),\n    folderNameProvider: x => x == Solution ? null : x.Name);\n\nglobalSolution.Save();\n')),(0,a.kt)("h2",{id:"working-with-projects-through-msbuild"},"Working with Projects through MSBuild"),(0,a.kt)("p",null,"Apart from reading the path and directory of a project through a ",(0,a.kt)("inlineCode",{parentName:"p"},"Solution")," object, you can also use the ",(0,a.kt)("a",{parentName:"p",href:"https://www.nuget.org/packages/Microsoft.Build"},"Microsoft.Build")," integration to access the MSBuild project model:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},"var msbuildProject = project.GetMSBuildProject();\n")),(0,a.kt)("p",null,"Again, you can also manually load the project using:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var msbuildProject = ProjectModelTasks.ParseProject("/path/to/file");\n')),(0,a.kt)("p",null,"Some of the most important information, like target frameworks, runtime identifiers, output type, properties, and item groups can also be retrieved with ",(0,a.kt)("strong",{parentName:"p"},"predefined helper methods"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var targetFrameworks = project.GetTargetFrameworks();\nvar runtimeIdentifiers = project.GetRuntimeIdentifiers();\nvar outputType = project.GetOutputType();\n\nvar isPackable = project.GetProperty<bool>("IsPackable");\nvar compiledFiles = project.GetItems<AbsolutePath>("Compile");\n')),(0,a.kt)("p",null,"However, behind the scenes, these methods will still load the project through the ",(0,a.kt)("inlineCode",{parentName:"p"},"Microsoft.Build")," package."),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"It is ",(0,a.kt)("strong",{parentName:"p"},"strongly discouraged")," to use anything but MSBuild to examine project files. Other approaches, like reading and parsing the XML, are very fragile against the complex evaluation logic that is inherent for project files."))))}m.isMDXComponent=!0}}]);